!function(n){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(e){return n(e,window,document)}):"object"==typeof exports?module.exports=function(e,t){return e=e||window,t&&t.fn.dataTable||(t=require("datatables.net")(e,t).$),n(t,e,e.document)}:n(jQuery,window,document)}(function(c,u,d,f){"use strict";var i=c.fn.dataTable,n=0,h=0,o=function(e,t){if(!i.versionCheck||!i.versionCheck("1.10.8"))throw"KeyTable requires DataTables 1.10.8 or newer";this.c=c.extend(!0,{},i.defaults.keyTable,o.defaults,t),this.s={dt:new i.Api(e),enable:!0,focusDraw:!1,waitingForDraw:!1,lastFocus:null,namespace:".keyTable-"+n++,tabInput:null},this.dom={};t=this.s.dt.settings()[0],e=t.keytable;if(e)return e;(t.keytable=this)._constructor()};return c.extend(o.prototype,{blur:function(){this._blur()},enable:function(e){this.s.enable=e},enabled:function(){return this.s.enable},focus:function(e,t){this._focus(this.s.dt.cell(e,t))},focused:function(e){if(!this.s.lastFocus)return!1;var t=this.s.lastFocus.cell.index();return e.row===t.row&&e.column===t.column},_constructor:function(){this._tabInput();var s,o=this,i=this.s.dt,e=c(i.table().node()),l=this.s.namespace,t=!1;"static"===e.css("position")&&e.css("position","relative"),c(i.table().body()).on("click"+l,"th, td",function(e){var t;!1===o.s.enable||(t=i.cell(this)).any()&&o._focus(t,null,!1,e)}),c(d).on("keydown"+l,function(e){t||o._key(e)}),this.c.blurable&&c(d).on("mousedown"+l,function(e){c(e.target).parents(".dataTables_filter").length&&o._blur(),c(e.target).parents().filter(i.table().container()).length||c(e.target).parents("div.DTE").length||c(e.target).parents("div.editor-datetime").length||c(e.target).parents("div.dt-datetime").length||c(e.target).parents().filter(".DTFC_Cloned").length||o._blur()}),this.c.editor&&((s=this.c.editor).on("open.keyTableMain",function(e,t,n){"inline"!==t&&o.s.enable&&(o.enable(!1),s.one("close"+l,function(){o.enable(!0)}))}),this.c.editOnFocus&&i.on("key-focus"+l+" key-refocus"+l,function(e,t,n,s){o._editor(null,s,!0)}),i.on("key"+l,function(e,t,n,s,i){o._editor(n,i,!1)}),c(i.table().body()).on("dblclick"+l,"th, td",function(e){!1!==o.s.enable&&i.cell(this).any()&&(o.s.lastFocus&&this!==o.s.lastFocus.cell.node()||o._editor(null,e,!0))}),s.on("preSubmit",function(){t=!0}).on("preSubmitCancelled",function(){t=!1}).on("submitComplete",function(){t=!1})),i.settings()[0].oFeatures.bStateSave&&i.on("stateSaveParams"+l,function(e,t,n){n.keyTable=o.s.lastFocus?o.s.lastFocus.cell.index():null}),i.on("column-visibility"+l,function(e){o._tabInput()}),i.on("draw"+l,function(e){var t,n,s;o._tabInput(),o.s.focusDraw||o.s.lastFocus&&(t=o.s.lastFocus.relative,n=i.page.info(),s=t.row+n.start,0!==n.recordsDisplay&&(s>=n.recordsDisplay&&(s=n.recordsDisplay-1),o._focus(s,t.column,!0,e)))}),this.c.clipboard&&this._clipboard(),i.on("destroy"+l,function(){o._blur(!0),i.off(l),c(i.table().body()).off("click"+l,"th, td").off("dblclick"+l,"th, td"),c(d).off("mousedown"+l).off("keydown"+l).off("copy"+l).off("paste"+l)});var n=i.state.loaded();n&&n.keyTable?i.one("init",function(){var e=i.cell(n.keyTable);e.any()&&e.focus()}):this.c.focus&&i.cell(this.c.focus).focus()},_blur:function(e){var t;this.s.enable&&this.s.lastFocus&&(t=this.s.lastFocus.cell,c(t.node()).removeClass(this.c.className),this.s.lastFocus=null,e||(this._updateFixedColumns(t.index().column),this._emitEvent("key-blur",[this.s.dt,t])))},_clipboard:function(){var o=this.s.dt,l=this,e=this.s.namespace;u.getSelection&&(c(d).on("copy"+e,function(e){var t=e.originalEvent,n=u.getSelection().toString(),e=l.s.lastFocus;!n&&e&&(t.clipboardData.setData("text/plain",e.cell.render(l.c.clipboardOrthogonal)),t.preventDefault())}),c(d).on("paste"+e,function(e){var t,n=e.originalEvent,s=l.s.lastFocus,i=d.activeElement,e=l.c.editor;!s||i&&"body"!==i.nodeName.toLowerCase()||(n.preventDefault(),u.clipboardData&&u.clipboardData.getData?t=u.clipboardData.getData("Text"):n.clipboardData&&n.clipboardData.getData&&(t=n.clipboardData.getData("text/plain")),e?e.inline(s.cell.index()).set(e.displayed()[0],t).submit():(s.cell.data(t),o.draw(!1)))}))},_columns:function(){var e=this.s.dt,t=e.columns(this.c.columns).indexes(),n=[];return e.columns(":visible").every(function(e){-1!==t.indexOf(e)&&n.push(e)}),n},_editor:function(e,t,n){var s,i,o,l,a,r;this.s.lastFocus&&(t&&"draw"===t.type||(i=(s=this).s.dt,o=this.c.editor,l=this.s.lastFocus.cell,a=this.s.namespace+"e"+h++,c("div.DTE",l.node()).length||null!==e&&(0<=e&&e<=9||11===e||12===e||14<=e&&e<=31||112<=e&&e<=123||127<=e&&e<=159)||(t&&(t.stopPropagation(),13===e&&t.preventDefault()),r=function(){o.one("open"+a,function(){o.off("cancelOpen"+a),n||c("div.DTE_Field_InputControl input, div.DTE_Field_InputControl textarea").select(),i.keys.enable(n?"tab-only":"navigation-only"),i.on("key-blur.editor",function(e,t,n){o.displayed()&&n.node()===l.node()&&o.submit()}),n&&c(i.table().container()).addClass("dtk-focus-alt"),o.on("preSubmitCancelled"+a,function(){setTimeout(function(){s._focus(l,null,!1)},50)}),o.on("submitUnsuccessful"+a,function(){s._focus(l,null,!1)}),o.one("close"+a,function(){i.keys.enable(!0),i.off("key-blur.editor"),o.off(a),c(i.table().container()).removeClass("dtk-focus-alt"),s.s.returnSubmit&&(s.s.returnSubmit=!1,s._emitEvent("key-return-submit",[i,l]))})}).one("cancelOpen"+a,function(){o.off(a)}).inline(l.index())},13===e?(n=!0,c(d).one("keyup",function(){r()})):r())))},_emitEvent:function(n,s){this.s.dt.iterator("table",function(e,t){c(e.nTable).triggerHandler(n,s)})},_focus:function(e,t,n,s){var i=this,o=this.s.dt,l=o.page.info(),a=this.s.lastFocus;if(s=s||null,this.s.enable){if("number"!=typeof e){if(!e.any())return;var r=e.index();if(t=r.column,(e=o.rows({filter:"applied",order:"applied"}).indexes().indexOf(r.row))<0)return;l.serverSide&&(e+=l.start)}if(-1!==l.length&&(e<l.start||e>=l.start+l.length))return this.s.focusDraw=!0,this.s.waitingForDraw=!0,void o.one("draw",function(){i.s.focusDraw=!1,i.s.waitingForDraw=!1,i._focus(e,t,f,s)}).page(Math.floor(e/l.length)).draw(!1);if(-1!==c.inArray(t,this._columns())){l.serverSide&&(e-=l.start);l=o.cells(null,t,{search:"applied",order:"applied"}).flatten(),l=o.cell(l[e]);if(a){if(a.node===l.node())return void this._emitEvent("key-refocus",[this.s.dt,l,s||null]);this._blur()}this._removeOtherFocus();a=c(l.node());a.addClass(this.c.className),this._updateFixedColumns(t),n!==f&&!0!==n||(this._scroll(c(u),c(d.body),a,"offset"),(n=o.table().body().parentNode)!==o.table().header().parentNode&&(n=c(n.parentNode),this._scroll(n,n,a,"position"))),this.s.lastFocus={cell:l,node:l.node(),relative:{row:o.rows({page:"current"}).indexes().indexOf(l.index().row),column:l.index().column}},this._emitEvent("key-focus",[this.s.dt,l,s||null]),o.state.save()}}},_key:function(e){if(this.s.waitingForDraw)e.preventDefault();else{var t=this.s.enable;this.s.returnSubmit=("navigation-only"===t||"tab-only"===t)&&13===e.keyCode;var n=!0===t||"navigation-only"===t;if(t&&(!(0===e.keyCode||e.ctrlKey||e.metaKey||e.altKey)||e.ctrlKey&&e.altKey)){var s=this.s.lastFocus;if(s)if(this.s.dt.cell(s.node).any()){var i,o,l=this.s.dt,a=!!this.s.dt.settings()[0].oScroll.sY;if(!this.c.keys||-1!==c.inArray(e.keyCode,this.c.keys))switch(e.keyCode){case 9:this._shift(e,e.shiftKey?"left":"right",!0);break;case 27:this.s.blurable&&!0===t&&this._blur();break;case 33:case 34:n&&!a&&(e.preventDefault(),l.page(33===e.keyCode?"previous":"next").draw(!1));break;case 35:case 36:n&&(e.preventDefault(),i=l.cells({page:"current"}).indexes(),o=this._columns(),this._focus(l.cell(i[35===e.keyCode?i.length-1:o[0]]),null,!0,e));break;case 37:n&&this._shift(e,"left");break;case 38:n&&this._shift(e,"up");break;case 39:n&&this._shift(e,"right");break;case 40:n&&this._shift(e,"down");break;case 113:if(this.c.editor){this._editor(null,e,!0);break}default:!0===t&&this._emitEvent("key",[l,e.keyCode,this.s.lastFocus.cell,e])}}else this.s.lastFocus=null}}},_removeOtherFocus:function(){var t=this.s.dt.table().node();c.fn.dataTable.tables({api:!0}).iterator("table",function(e){this.table().node()!==t&&this.cell.blur()})},_scroll:function(e,t,n,s){var i=n[s](),o=n.outerHeight(),l=n.outerWidth(),a=t.scrollTop(),r=t.scrollLeft(),c=e.height(),e=e.width();"position"===s&&(i.top+=parseInt(n.closest("table").css("top"),10)),i.top<a&&t.scrollTop(i.top),i.left<r&&t.scrollLeft(i.left),i.top+o>a+c&&o<c&&t.scrollTop(i.top+o-c),i.left+l>r+e&&l<e&&t.scrollLeft(i.left+l-e)},_shift:function(e,t,n){var s,i=this.s.dt,o=i.page.info(),l=o.recordsDisplay,a=this._columns(),r=this.s.lastFocus;!r||(s=r.cell)&&(r=i.rows({filter:"applied",order:"applied"}).indexes().indexOf(s.index().row),o.serverSide&&(r+=o.start),r=r,s=a[i=i.columns(a).indexes().indexOf(s.index().column)],"right"===t?s=i>=a.length-1?(r++,a[0]):a[i+1]:"left"===t?s=0===i?(r--,a[a.length-1]):a[i-1]:"up"===t?r--:"down"===t&&r++,0<=r&&r<l&&-1!==c.inArray(s,a)?(e&&e.preventDefault(),this._focus(r,s,!0,e)):n&&this.c.blurable?this._blur():e&&e.preventDefault())},_tabInput:function(){var e,n=this,s=this.s.dt,t=null!==this.c.tabIndex?this.c.tabIndex:s.settings()[0].iTabIndex;-1!=t&&(this.s.tabInput||((e=c('<div><input type="text" tabindex="'+t+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"})).children().on("focus",function(e){var t=s.cell(":eq(0)",n._columns(),{page:"current"});t.any()&&n._focus(t,null,!0,e)}),this.s.tabInput=e),(e=this.s.dt.cell(":eq(0)","0:visible",{page:"current",order:"current"}).node())&&c(e).prepend(this.s.tabInput))},_updateFixedColumns:function(e){var t,n=this.s.dt,s=n.settings()[0];s._oFixedColumns&&(t=s._oFixedColumns.s.iLeftColumns,s=s.aoColumns.length-s._oFixedColumns.s.iRightColumns,(e<t||s<=e)&&n.fixedColumns().update())}}),o.defaults={blurable:!0,className:"focus",clipboard:!0,clipboardOrthogonal:"display",columns:"",editor:null,editOnFocus:!1,focus:null,keys:null,tabIndex:null},o.version="2.6.1",c.fn.dataTable.KeyTable=o,c.fn.DataTable.KeyTable=o,i.Api.register("cell.blur()",function(){return this.iterator("table",function(e){e.keytable&&e.keytable.blur()})}),i.Api.register("cell().focus()",function(){return this.iterator("cell",function(e,t,n){e.keytable&&e.keytable.focus(t,n)})}),i.Api.register("keys.disable()",function(){return this.iterator("table",function(e){e.keytable&&e.keytable.enable(!1)})}),i.Api.register("keys.enable()",function(t){return this.iterator("table",function(e){e.keytable&&e.keytable.enable(t===f||t)})}),i.Api.register("keys.enabled()",function(e){var t=this.context;return!!t.length&&(!!t[0].keytable&&t[0].keytable.enabled())}),i.Api.register("keys.move()",function(t){return this.iterator("table",function(e){e.keytable&&e.keytable._shift(null,t,!1)})}),i.ext.selector.cell.push(function(e,t,n){var s=t.focused,i=e.keytable,o=[];if(!i||s===f)return n;for(var l=0,a=n.length;l<a;l++)(!0===s&&i.focused(n[l])||!1===s&&!i.focused(n[l]))&&o.push(n[l]);return o}),c(d).on("preInit.dt.dtk",function(e,t,n){var s;"dt"===e.namespace&&(s=t.oInit.keys,e=i.defaults.keys,(s||e)&&(e=c.extend({},e,s),!1!==s&&new o(t,e)))}),o});